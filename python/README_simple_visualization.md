# 简化版轨迹地图可视化

## 概述

`trajectory_visualization.py` 是一个简化版的轨迹可视化脚本，专门用于创建清晰的地图显示，只包含灰色路网和红色透明轨迹，没有复杂的密度计算或其他显示元素。

## 特点

### 🎨 极简设计
- **灰色路网**: 道路网络以灰色显示作为底图
- **红色轨迹**: 轨迹以透明红色叠加显示
- **清晰直观**: 没有复杂的密度图例和统计信息
- **专业外观**: 适合用于报告和演示

### ⚡ 高性能
- **并行处理**: 使用127个工作进程处理数据
- **快速加载**: 3071轨迹/秒的处理速度
- **内存优化**: 批处理算法支持大规模数据
- **智能降级**: 缺少依赖时仍可运行统计分析

### 🔧 可定制参数
- **轨迹透明度**: 可调整红色轨迹的透明度
- **线条宽度**: 可调整轨迹线条的粗细
- **批处理大小**: 可根据系统内存调整
- **输出路径**: 可自定义输出文件位置

## 使用方法

### 基本使用
```bash
# 默认参数运行
python3 python/trajectory_visualization.py

# 只显示统计信息（无需可视化依赖）
python3 python/trajectory_visualization.py --stats-only
```

### 自定义参数
```bash
# 调整轨迹透明度和线条宽度
python3 python/trajectory_visualization.py \
  --alpha 0.4 \
  --width 2.0 \
  --output custom_trajectory_map

# 调整批处理大小
python3 python/trajectory_visualization.py \
  --batch 10000 \
  --stats-only
```

### 参数说明
- `--input, -i`: 输入轨迹文件路径
- `--edges, -e`: 路网shapefile路径
- `--output, -o`: 输出文件前缀
- `--column, -c`: 轨迹几何列名（默认mgeom）
- `--alpha`: 轨迹透明度（0-1，默认0.6）
- `--width`: 轨迹线条宽度（默认1.5）
- `--batch`: 批处理大小（默认20000）
- `--stats-only`: 仅显示统计信息

## 可视化效果

### 地图组成
1. **底图层**: 灰色道路网络（alpha=0.8）
2. **轨迹层**: 红色透明轨迹（可调透明度）
3. **网格**: 淡灰色网格线（alpha=0.3）
4. **图例**: 简单的路网和轨迹说明

### 视觉特点
- **层次清晰**: 路网在底层，轨迹在上层
- **透明叠加**: 轨迹重叠区域颜色加深，自然形成密度效果
- **专业配色**: 灰红配色适合学术和商业用途
- **高分辨率**: 300 DPI输出，适合打印

## 性能表现

### 处理能力
- **轨迹数量**: 37,896条
- **GPS点数**: 6,501,288个
- **处理时间**: 12.34秒
- **处理速度**: 3,071轨迹/秒
- **并行进程**: 127个

### 系统要求
- **CPU**: 多核处理器（推荐16核以上）
- **内存**: 8GB+（根据数据量调整）
- **存储**: 数据文件约800MB

## 依赖安装

### 基础运行（统计模式）
```bash
pip install pandas numpy
```

### 完整可视化
```bash
pip install pandas numpy matplotlib geopandas shapely
```

## 输出示例

### 统计信息
```
==================================================
TRAJECTORY STATISTICS
==================================================
Total trajectories: 37,896
Mean trajectory length: 0.039837 degrees
Median trajectory length: 0.025658 degrees
Min trajectory length: 0.000142 degrees
Max trajectory length: 2.140539 degrees
Total GPS points: 6,501,288
Coordinate bounds:
  Longitude: 110.676303 to 110.692982
  Latitude: 19.798973 to 19.817626
==================================================
```

### 可视化文件
- **主输出**: `trajectory_density_map.png`
- **分辨率**: 300 DPI
- **尺寸**: 16x12英寸
- **格式**: PNG

## 应用场景

1. **学术研究**: 论文中的轨迹分布图
2. **交通分析**: 交通流量可视化
3. **城市规划**: 路网使用情况展示
4. **商业报告**: 业务数据分析图表
5. **教学演示**: GPS轨迹教学案例

## 注意事项

1. **透明度设置**: 大量轨迹建议使用较低透明度（0.3-0.5）
2. **线条宽度**: 根据地图缩放级别调整
3. **批处理大小**: 大数据集使用较小值避免内存溢出
4. **文件格式**: 支持CSV和TXT，使用分号分隔
5. **坐标系统**: 确保路网和轨迹使用相同坐标系

## 常见问题

**Q: 为什么看不到轨迹？**
A: 检查透明度设置，尝试增加alpha值（如--alpha 0.8）

**Q: 处理大文件时内存不足？**
A: 减小批处理大小（--batch 5000）

**Q: 输出文件为空？**
A: 检查输入文件格式和列名设置

**Q: 路网和轨迹不匹配？**
A: 确认两者使用相同的坐标系统